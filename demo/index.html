<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Serendip SDK Demo App</title>
    <script src="/src/jquery-1.10.1.min.js"></script>
    <script>
        window.onSrndpReady = function() {
            // Generic error handling
            errFunc = function(error) {
                if (error.throwable) throw error.msg;
            };
            loginFunc = function(loginObj) {
                if (loginObj.newUser) {
                    nu = loginObj.newUserObj;
                    window.NEW_USER_OBJ = nu;
                    clearAllMessages();
                    showLoggedIn(true);
                    $("#newuser_msg").html("Name: "+ nu.name + "<br/>Username: " + nu.username + "<br/>email: " + nu.email);
                } else {
                    showLoggedIn();
                    if (loginObj.facebook_authorized)
                        showMoreLoginOptions();
                }
            };
            onStatusChange = function(resp) {
                if (resp.status == "logged_in") {
                    showLoggedIn();
                } else if (resp.status == "signing_up") {
                    showLoggedIn(true);
                } else {
                    if (resp.srndp_authorized) {
                        clearUI();
                        updateMessage("Logging In ...");
                        SRNDP.login("serendip",true).done(loginFunc).fail(errFunc);
                    }
                    else if (resp.facebook_authorized) {
                        clearUI();
                        updateMessage("Logging In ...");
                        SRNDP.login("facebook",true).done(loginFunc).fail(errFunc);
                    }
                    else {
                        showLoggedOut();
                    }
                }
            }

            clearUI = function() {
                $("#login").hide();
                $("#hello").hide();
            };
            showLoggedOut = function() {
                $("#login").show();
                $("#hello").hide();
            };
            showLoggedIn = function(newUser) {
                $("#hello").show();
                $("#more_login_options").hide();
                $("#logout").show();
                $("#login").hide();
                $("#newuser").hide()
                if (newUser)
                    $("#newuser").show()
                else
                    showProfile();
            };
            showMoreLoginOptions = function() {
                $("#more_login_options").show();
                $("#logout").hide();
            }
            updateMessage = function(msg) {
                $("#message").html(msg);
            };
            clearAllMessages = function() {
                $("#message").empty();
            };
            showProfile = function() {
                clearAllMessages();
                SRNDP.api("/dj/info.json",{},true).done(
                  function (me) {
                      $("#profile").html("<div>Hello "+me.userName+"</div>");
                      $("#profile").append("<div><img style='width: 50px; height: 50px;' src='"+me.profilePicture+"'/></div>");
                  }
                ).fail(errFunc);
            }

            // init the SRNDP JS SDK
            SRNDP.init({
                clientId      : '98f3cf75'
            }).done(
                function(response) {
                    if (response.status == 'ok') {
                        <!-- check login status and display appropriate UI -->
                        SRNDP.getLoginStatus().done(onStatusChange).fail(errFunc);
                        SRNDP.subscribe("srndp.statusChange",onStatusChange);
                    }
                }
            ).fail(errFunc);

            // Additional initialization code such as adding Event Listeners goes here
        };
        $(document).ready(
            function() {
                <!--Set click event handler for auth ops -->

                $("#login-facebook").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.login("facebook").done(loginFunc).fail(errFunc);
                        }
                    }
                );
                $("#login-twitter, #with_twitter").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.login("twitter").done(loginFunc).fail(errFunc);
                        }
                    }
                );

                $("#another_user").click(
                        function(e) {
                            e.preventDefault();
                            if (typeof SRNDP != 'undefined') {
                                SRNDP.logout(true);
                            }
                        }
                )
                $("#register").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.register(NEW_USER_OBJ.username, NEW_USER_OBJ.name, true, NEW_USER_OBJ.email,null, true).fail(errFunc);;
                        }
                    }
                );

                $("#logout").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.logout().fail(errFunc);
                        }
                    }
                )
            }
        )
</script>
    <!-- Load the SDK asynchronously -->

    <!--
    <script>
        (function(d, s, id){
            var js, sjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "http://developers.serendip.me:8000/lib/sdk.js";
            sjs.parentNode.insertBefore(js, sjs);
        })(document, 'script', 'srndp-jssdk');

    </script>
    -->
    <script data-main="../src/sdk" src="../src/require.js"></script>
</head>
<body>
    <div id="message"></div><div></div>
    <div id="login" class="section" style="display: none;">
        <div><a id="login-facebook" href="#">Login With Facebook</a></div>
        <div><a id="login-twitter" href="#">Login With Twitter</a></div>
    </div>
    <div id="hello" class="section" style="display: none;">
        <div id="profile"></div>
        <div id="newuser" style="display: none;">
            <div id="newuser_msg"></div>
            <div><a id="register" href="#">Register</a></div>
        </div>
        <div><a id="logout" href="#">Logout</a></div>
        <div id="more_login_options" style="display: none;">
            <div><a id="another_user"  href="#">Login As Another FB User</a></div>
            <div><a id="with_twitter" href="#">Login With Twitter</a></div>
        </div>
    </div>
</body>
</html>