<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Serendip SDK Demo App</title>
    <script src="/src/jquery-1.10.1.min.js"></script>
    <script>
        window.onSrndpReady = function() {
            // Generic error handling
            errFunc = function(error) {
                if (error.throwable) throw error.msg;
            };
            loginFunc = function(loginObj) {
                if (loginObj.newUser) {
                    clearAllMessages();
                    showLoggedIn(true);
                    $("#profile").html("Hello new user Is your name " + loginObj.newUserObj.name + "?");
                } else {
                    showLoggedIn();
                }
            };
            onStatusChange = function(resp) {
                if (resp.status == "logged_in" && SRNDP.isActive()) {
                    showLoggedIn();
                } else {
                    if (resp.facebook_authorized) {
                        clearUI();
                        updateMessage("Logging In ...");
                        SRNDP.login("facebook",true).done(loginFunc).fail(errFunc);
                    }
                    else {
                        showLoggedOut();
                    }
                }
            }

            clearUI = function() {
                $("#login").hide();
                $("#hello").hide();
            };
            showLoggedOut = function() {
                $("#login").show();
                $("#hello").hide();
            };
            showLoggedIn = function(newUser) {
                $("#hello").show();
                $("#login").hide();
                if (!newUser) showProfile();
            };
            updateMessage = function(msg) {
                $("#message").html(msg);
            };
            clearAllMessages = function() {
                $("#message").empty();
            };
            showProfile = function() {
                clearAllMessages();
                SRNDP.api("/dj/info.json",{},true).done(
                  function (me) {
                      $("#profile").html("<div>Hello "+me.userName+"</div>");
                      $("#profile").append("<div><img style='width: 50px; height: 50px;' src='"+me.profilePicture+"'/></div>");
                  }
                ).fail(errFunc);
            }
            getMyFeed = function() {
                <!--Call to authenticated endpoint to display my feed-->
                SRNDP.api("/feed/home.json",{},true).done(
                    function(feed) {
                        if (feed.count > 0) {
                            for (i = 0; i < feed.tracks.length; i++) {
                                $("#feed").append("<div>"+feed.tracks[i].title+"</div>");
                            }
                        }
                    }
                ).fail(errFunc);
            };
            // init the SRNDP JS SDK
            SRNDP.init({
                clientId      : '98f3cf75'
            }).done(
                function(response) {
                    if (response.status == 'ok') {
                        <!-- check login status and display appropriate UI -->
                        SRNDP.getLoginStatus().done(onStatusChange).fail(errFunc);
                        SRNDP.subscribe("srndp.statusChange",onStatusChange);
                    }
                }
            ).fail(errFunc);

            // Additional initialization code such as adding Event Listeners goes here
        };
        $(document).ready(
            function() {
                <!--Set click event handler for auth ops -->

                $("#login-facebook").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.login("facebook").done(loginFunc).fail(errFunc);
                        }
                    }
                );
                $("#login-twitter").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.login("twitter").done(loginFunc).fail(errFunc);
                        }
                    }
                );
                $("#logout").click(
                    function(e) {
                        e.preventDefault();
                        if (typeof SRNDP != 'undefined') {
                            SRNDP.logout().done(
                                function(response) {
                                    if (response.status == 'ok') {
                                        showLoggedOut();
                                    }
                                }
                            ).fail(errFunc);
                        }
                    }
                )
            }
        )

        // Load the SDK asynchronously
/***
        (function(d, s, id){
            var js, sjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "http://localhost:8000/lib/sdk.js";
            sjs.parentNode.insertBefore(js, sjs);
        }(document, 'script', 'srndp-jssdk'));
***/
    </script>
    <script data-main="../src/sdk" src="../src/require.js"></script>
</head>
<body>
    <div id="message"></div><div></div>
    <div id="login" style="display: none;">
        <div><a id="login-facebook" href="#">Login With Facebook</a></div>
        <div><a id="login-twitter" href="#">Login With Twitter</a></div>
    </div>
    <div id="hello" style="display: none;">
        <div id="profile"></div>
        <div><a id="logout" href="#">Logout</a></div>
        <div id="feed"></div>
    </div>
</body>
</html>